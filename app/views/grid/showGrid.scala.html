    @* showGrid Template File *@
@import common._

@main("Welcome to Play") {
<script type="text/javascript">

        $(function() {
            $.get("@routes.HomeController.getGridData", function(data, status){
                showGrid(data);
                console.log("Data: " + data );
            });
        });

        var lastSel;
        var params = {};
        params.comment = 'loaf';
        var editparameters = {
                keys : true,
                oneditfunc : function(){
                    console.log("start edit");
                },
                successfunc : function(xhr){
                    console.log(xhr.responseText);
                },
                url : "@routes.HomeController.receiveDataDB",
                extraparam : params,
                restoreAfterError : true
            }

        var saveparameters = {
                successfunc : function(xhr){
                    console.log(xhr.responseText);
                },
                url : "@routes.HomeController.receiveDataDB",
                extraparam : params,
                aftersavefunc : function(){
                    console.log('saved');
                },
                errorfunc: null,
                afterrestorefunc : null,
                restoreAfterError : true
            }
        var mydata = [
                {id:"1",invdate:"2007-10-01",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
                {id:"2",invdate:"2007-10-02",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
                {id:"3",invdate:"2007-09-01",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
                {id:"4",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
                {id:"5",invdate:"2007-10-05",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
                {id:"6",invdate:"2007-09-06",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
                {id:"7",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
                {id:"8",invdate:"2007-10-03",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
                {id:"9",invdate:"2007-09-01",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"}
        ],
        myDelOptions = {
            // because I use "local" data I don't want to send the changes to the server
            // so I use "processing:true" setting and delete the row manually in onclickSubmit
            onclickSubmit: function (rp_ge, rowid) {
                // reset the value of processing option to true to
                // skip the ajax request to 'clientArray'.
                rp_ge.processing = true;

                // we can use onclickSubmit function as "onclick" on "Delete" button
                // delete row
                var grid = $('#list4');
                grid.jqGrid('delRowData', rowid);
                $("#delmod" + grid[0].id).hide();

                if (grid[0].p.lastpage > 1) {
                    // reload grid to make the row from the next page visable.
                    // TODO: deleting the last row from the last page which number is higher as 1
                    grid.trigger("reloadGrid", [{ page: grid[0].p.page}]);
                }

                return true;
            },
            processing: true
        },
        myEditOptions = {
            // because I use "local" data I don't want to send the changes to the server
            // so I use "processing:true" setting and delete the row manually in onclickSubmit
            onclickSubmit: function (rp_ge, rowid) {
            //     // reset the value of processing option to true to
            //     // skip the ajax request to 'clientArray'.
                rp_ge.processing = true;
            //
            //     // we can use onclickSubmit function as "onclick" on "Delete" button
            //     // delete row
                // var $self = $('#list4');
                var grid = $('#list4');
                grid.jqGrid("saveRow", rowid, saveparameters);
                // var $self = $('#list4'),
            //     // savedRows array is not empty if some row is in inline editing mode
                // savedRows = $self.jqGrid("getGridParam", "savedRow");
                // if (savedRows.length > 0) {
                //     $self.jqGrid("restoreRow", savedRows[0].id);
                // }
                // $self.jqGrid("editRow", rowid, editparameters);
                console.log('Used');

                return true;
            },
            processing: true
        };
        // function SaveStudentEvaluation(index) {
        //     saveparameters = {
        //         "successfunc": null,
        //         "url": null,
        //         "extraparam": {},
        //         "aftersavefunc": null,
        //         "errorfunc": null,
        //         "afterrestorefunc": null,
        //         "restoreAfterError": true,
        //         "mtype": "POST"
        //       }
        // }

        // var orgRowActions = $.fn.fmatter.rowactions;
        //    $.fn.fmatter.rowactions = function (e, act) {
        //        var $grid = $(this).closest("table.ui-jqgrid-btable"),
        //            rowid = $(this).closest("tr.jqgrow").attr("id");
        //        if (act === "edit") {
        //            $grid.jqGrid("viewGridRow", rowid);
        //         //    $grid.jqGrid('editRow', rowid, editparameters);
        //            return false;
        //        }
        //        return orgRowActions.call(this, e, act);
        //    }
        function showGrid() {
            var postData = {};
            postData.time = "travel";
            postData.ring = "loard";
            jQuery("#list4").jqGrid({
                datatype: "local",
                pager: "#jqGridPager",
                height: 250,
                colNames:['Inv No','Date', 'Client', 'Amount','Tax','Total','Notes', 'Actions'],
                colModel:[
                    {name:'id',index:'id', width:60, sorttype:"int", editable:true},
                    {name:'invdate',index:'invdate', width:90, sorttype:"date", editable:true},
                    {name:'name',index:'name', width:100, editable:true},
                    {name:'amount',index:'amount', width:80, align:"right",sorttype:"float", editable:true},
                    {name:'tax',index:'tax', width:80, align:"right",sorttype:"float", editable:true},
                    {name:'total',index:'total', width:80,align:"right",sorttype:"float", editable:true},
                    {name:'note',index:'note', width:150, sortable:false, editable:true},
                    {name:'act',index:'act', width:75,sortable:false, formatter: buttonFormat,
                        formatoptions : {
                            keys : true,
                            delOptions : myEditOptions,
                            // editOptions : this.beforeSubmitCell,
                            editbutton : true,
                            delbutton : true
                        },
                        // editoptions : { dataEvents: [{type: 'click', data: { comment: "comment" }, fn: function(e) { console.log(e.data.i); }}, {type: 'keypress', fn: function(e) { console.log('keypress'); } }]}
                    //     editoptions: {
                    //       custom_element: function(value, options) {
                    //           var val = $(value);
                    //           var elem = $('<div id="'+options.id+'"/>');
                    //           setTimeout(function(){
                    //               elem.raty({
                    //                   path:'http://www.ok-soft-gmbh.com/jquery.raty/1.0.1/img/',
                    //                   start:(val.length>1? val[1].innerText: value)
                    //               });
                    //           }, 100);
                    //           return elem[0];
                    //       },
                    //       custom_value: function(elem) {
                    //           return elem.find("input").val();
                    //       }
                    //   }
                    }
                ],
                viewrecords: true,
                // ajaxRowOptions: { contentType: "application/json", dataType: "json" },
                // serializeRowData: function (data) { return JSON.stringify(data); },
                caption: "Manipulating Array Data",
                onSelectRow: function(rowid){
//                    var $self = $(this),
//                    // savedRows array is not empty if some row is in inline editing mode
//                    savedRows = $self.jqGrid("getGridParam", "savedRow");
//                    if (savedRows.length > 0) {
//                        $self.jqGrid("restoreRow", savedRows[0].id);
//                    }
//                    $self.jqGrid("editRow", rowid, editparameters);
                },
                gridComplete: function(){
                },
                editurl: "@routes.HomeController.receiveDataDB",
                // cellEdit : true,
                // cellsubmit : 'remote',
                // cellurl : '@routes.HomeController.receiveDataDB',
                // beforeSubmitCell : function(rowid,celname,value,iRow,iCol) {
                //   if( rowid == 1 ) {
                //     return {comment:"value1"}
                //   } else{
                //     return {}
                //   }
                // }
            });
            for(var i=0;i<=mydata.length;i++) {
                $("#list4").jqGrid('addRowData',i+1,mydata[i]);
            }
            $.extend(true, $.jgrid.inlineEdit, {
                beforeSaveRow: function (option, rowId) {
                    option.oneditfunc = function(){
                        console.log("start edit");
                    },
                    option.successfunc = function(xhr){
                        console.log(xhr.responseText);
                    },
                    option.url = "@routes.HomeController.receiveDataDB",
                    option.extraparam = params,
                    option.restoreAfterError = true
                }
            });
     }

        function buttonFormat( cellvalue, options, rowObject ){
            be = "<input style='height:22px;width:20px;' type='button' value='E' onclick=\"jQuery('#list4').jqGrid('editRow', '"+options.rowId+"');\"  />";
            se = "<input style='height:22px;width:20px;' type='button' id='saveId' value='S' onclick=\"jQuery('#list4').jqGrid('saveRow', '"+options.rowId+"');\"/>";
            ce = "<input style='height:22px;width:20px;' type='button' value='C' onclick=\"jQuery('#list4').restoreRow('"+options.rowId+"');\" />";
            return be + se + ce;
        }

    </script>

    <div>
        <input type="button" onclick="location.href='@routes.CountController.testGrid';" value="test grid page" />
    </div>
    <div style="margin-top:20px;">
        <table id="list4"></table>
    </div>
}
